global:
  scrape_interval: 5s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'prometheus-pump'
    metrics_path: '/metrics'
    scrape_interval: 5s
    static_configs:
      - targets: [ 'localhost:2112' ]

  - job_name: 'federate-metrics-service-nodes'
    metrics_path: '/federate'
    params:
      'match[]':
        - '{__name__=~".+"}'
    static_configs:
{% for tag, node in hostvars['localhost']['service_nodes_metadata'].items() %}
  {% set target_ip = node.virtual_ip_address if node.enable_service_ha and node.active else node.admin_ip %}
  - targets: ["{{ target_ip }}:9090"]
{% endfor %}

